# OPC-UAサーバーシミュレーター要件定義

## 1. 概要

本プロジェクトでは、AWS IoT SiteWiseおよびSiteWise Edgeのテスト環境用に、製造工場を模したOPC-UAサーバーシミュレーターを開発します。このシミュレーターはPython 3.12環境で動作し、実際の工場設備から収集されるデータを模擬的に生成します。

## 2. 機能要件

### 2.1 基本機能

- Python 3.12環境で動作するOPC-UAサーバーの実装
- 5秒間隔でクライアントからデータ取得可能な構成
- 各センサー値は毎秒少しずつ変化する動的なデータ生成
- 製造工場を想定したセンサー構成
- 1時間に1回程度（ランダムタイミング）で機器故障をシミュレート

### 2.2 シミュレートするセンサー/機器

製造工場を想定し、以下のセンサー/機器をシミュレートします：

#### 生産ライン1
1. **コンベアベルト**
   - 速度 (m/s)
   - モーター温度 (°C)
   - 電流値 (A)
   - 稼働状態 (Boolean)

2. **プレス機**
   - 圧力 (kPa)
   - 油圧システム温度 (°C)
   - サイクル数 (count)
   - 稼働状態 (Boolean)

3. **溶接ロボット**
   - アーム位置 X, Y, Z (mm)
   - 溶接電流 (A)
   - 溶接温度 (°C)
   - 稼働状態 (Boolean)

#### 生産ライン2
4. **CNC工作機械**
   - 回転速度 (rpm)
   - 切削工具温度 (°C)
   - 振動レベル (mm/s²)
   - 稼働状態 (Boolean)

5. **塗装ブース**
   - 温度 (°C)
   - 湿度 (%)
   - 塗料流量 (L/min)
   - 稼働状態 (Boolean)

#### 環境モニタリング
6. **工場環境センサー**
   - 室温 (°C)
   - 湿度 (%)
   - CO2濃度 (ppm)
   - 騒音レベル (dB)

7. **電力モニタリング**
   - 総消費電力 (kW)
   - 電圧 (V)
   - 力率 (%)

### 2.3 データ変動パターン

各センサーは以下のパターンでデータを生成します：

1. **通常動作時**
   - 各センサー値は設定された正常範囲内で少しずつ変動
   - 変動はランダム要素を含むが、急激な変化はしない
   - 生産サイクルに応じた周期的な変動パターンを一部含む

2. **故障シミュレーション時**
   - 1時間に1回程度、ランダムに選択された機器で故障をシミュレート
   - 故障パターンは複数用意（急激な温度上昇、振動増加、停止など）
   - 故障状態は一定時間（5〜15分）継続した後、自動復旧

## 3. 技術要件

### 3.1 開発環境
- Python 3.12
- asyncua（Python OPC-UA実装ライブラリ）

### 3.2 アーキテクチャ
- 非同期処理を活用したサーバー実装
- モジュール化された設計（センサー定義、データ生成、OPC-UAサーバー部分を分離）
- 設定ファイルによるパラメータ調整機能

### 3.3 OPC-UA仕様
- 標準的なOPC-UAサーバー機能の実装
- 各センサーは適切なノード構造で編成
- データアクセス（DA）機能の実装
- 最低限のセキュリティ機能の実装

## 4. 非機能要件

### 4.1 パフォーマンス
- 最低10クライアントからの同時接続をサポート
- 5秒間隔のデータ更新に対応できる処理性能

### 4.2 信頼性
- エラー発生時の適切なログ出力
- 予期せぬ終了を防ぐ例外処理

### 4.3 拡張性
- 新しいセンサー/機器の追加が容易な設計
- パラメータ調整が容易な設計

## 5. 制約条件
- Python 3.12環境での動作保証
- 外部依存ライブラリの最小化

## 6. 成果物
- OPC-UAサーバーシミュレーターのソースコード
- 実行手順書（README）
- 設定ファイルのサンプル

## 7. テスト基準
- OPC-UAクライアントからの接続テスト
- データ生成パターンの検証
- 故障シミュレーション機能の動作確認
- 長時間動作テスト（最低24時間）
